var Cart=function(t){Math.sign=Math.sign||function(t){"use strict";return t=+t,0===t||isNaN(t)?t:t>0?1:-1};var o=this.state={options:$.extend(!0,{v:1,debug:!1,queryParams:["product_id"],keys:{discountPrice:!1,price:"price",totalProduct:"total",count:"count"},cookieNames:{cart:"cart",cartVersion:"cart-version"},coreMethods:{},customSearch:!1,multipleQuery:!1,productModel:{}},t),products:[]},e=function(){return void 0==Cookies.get(o.options.cookieNames.cartVersion)&&Cookies.set(o.options.cookieNames.cartVersion,o.options.v,{path:"/"}),parseFloat(Cookies.get(o.options.cookieNames.cartVersion))==o.options.v},r=function(t,o){$(window).trigger(t,o)},s=$.extend({getProductById:function(t){"use strict";var e=t[o.options.queryParams[0]],r=null;return $.each(o.products,function(t,s){if(s[o.options.queryParams[0]]===e)return r=o.products[t],!1}),r},getProductByParams:function(t){"use strict";var e=null,r=null;return $.each(o.products,function(s,c){if(r=!0,$.each(o.options.queryParams,function(o,e){if(c[e]!==t[e])return r=!1,!1}),r)return e=o.products[s],!1}),e},checkValidityProduct:function(t){"use strict";return $.each(o.options.productModel,function(o,e){if(void 0==o||typeof t[o]!==e)throw new TypeError("Product Model is invalid")}),!0},updateProduct:function(t,e,r){"use strict";var s=this.searchProduct(t);return void 0==s[o.options.keys.count]&&(s[o.options.keys.count]=0),r?s[o.options.keys.count]=e:s[o.options.keys.count]+=e,s[o.options.keys.count]<1&&($.each(o.products,function(t,e){if(e[o.options.keys.count]<1)return o.products.splice(t,1),!1}),s=this.searchProduct(t)),s},createProduct:function(t,e){"use strict";return t[o.options.keys.count]=e,o.products.push(t),t},searchProduct:function(t){"use strict";return o.options.customSearch?this.getProduct(t):o.options.multipleQuery?this.getProductByParams(t):this.getProductById(t)},hasProduct:function(t){"use strict";return null!==this.searchProduct(t)},updateCart:function(){"use strict";return $.each(o.products,function(t,e){e[o.options.keys.count]>0&&(e[o.options.keys.totalProduct]=e[o.options.keys.count]*(e[o.options.keys.discountPrice]||e[o.options.keys.price]))}),r("cart.update",{cart:o.products}),o.products},response:function(t){"use strict";return this.updateCart(),this.updateCookie(),t},getCart:function(){"use strict";return o.products=this.formatToWork(Cookies.getJSON(o.options.cookieNames.cart)||[]),o.products},updateCookie:function(){"use strict";var t=new Date;t.setTime(t.getTime()+108e5),Cookies.set(o.options.cookieNames.cart,JSON.stringify(this.formatToSave(o.products)),{path:"/",expires:t})},deleteCookie:function(t){"use strict";return Cookies.remove(t,{path:"/"})},formatToSave:function(t){return t},formatToWork:function(t){return t}},o.options.coreMethods);return{init:function(){"use strict";o.options.queryParams.length>1&&(o.options.multipleQuery=!0),e()||(s.deleteCookie(o.options.cookieNames.cart),Cookies.set(o.options.cookieNames.cartVersion,o.options.v,{path:"/"})),o.products=s.getCart(),s.updateCart(),s.updateCookie(),r("cart.init",{cart:o.products})},add:function(t,e,r){"use strict";s.checkValidityProduct(t),e="number"!=typeof e?1:Math.abs(e);var c=s.hasProduct(t)?s.updateProduct(t,e):s.createProduct(t,e);return r=r||$.noop,r(c,o.products),s.response(c)},"delete":function(t,e,r){"use strict";s.checkValidityProduct(t),e="number"!=typeof e?-1:Math.abs(e)*-1;var c=s.hasProduct(t)?s.updateProduct(t,e):null;return r=r||$.noop,r(c,o.products),s.response(c)},set:function(t,e,r){"use strict";s.checkValidityProduct(t),e="number"!=typeof e?1:Math.abs(e);var c=s.hasProduct(t)?s.updateProduct(t,e,!0):s.createProduct(t,e);return r=r||$.noop,r(c,o.products),s.response(c)},deleteAll:function(t,e){"use strict";s.checkValidityProduct(t);var r=s.hasProduct(t),c=r?s.updateProduct(t,r[o.options.keys.count]):null;return e=e||$.noop,e(c,o.products),s.response(c)},getProduct:function(t){"use strict";return s.checkValidityProduct(t),s.response(s.searchProduct(t))},getTotalSumByProduct:function(t){"use strict";s.checkValidityProduct(t);var e=s.response(s.searchProduct(t)),r={};return e&&(r.discountPrice=e[o.options.keys.count]*e[o.options.keys.discountPrice],r.total=e[o.options.keys.totalProduct],r.count=e[o.options.keys.count]),e?r:null},formatPrice:function(t,o,e){"use strict";if(t=parseInt(t.toString().replace(/\D+/g,"")),e=e||/(\d)(?=(\d{3})+(?!\d))/g,o=o||" ","number"!=typeof t)throw new TypeError("Не является числом");return t.toString().replace(e,"$1"+o)},getNumEnding:function(t,o){var e,r;if(t%=100,t>=11&&t<=19)e=o[2];else switch(r=t%10){case 1:e=o[0];break;case 2:case 3:case 4:e=o[1];break;default:e=o[2]}return e},state:o}};